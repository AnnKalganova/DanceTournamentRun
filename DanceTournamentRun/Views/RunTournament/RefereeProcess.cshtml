@model Group
<div class="mt-3 ml-0">
    <h2>Шаг 2 - @Model.Name</h2>
    <h4>Процесс судейства</h4>

    <div id="refProgress" class="mt-3 mb-3">
        @await Component.InvokeAsync("RefereeProcess",
            new
            {
                groupId = Model.Id
            }
       )
    </div>

    <div class=" m-0 d-flex justify-content-between">
        <div>
            <a id="calcResBtn" onclick="calcResults(@Model.Id)" class="btn btn-info rounded-pill rn-btn mr-2 disabled">
                Посчитать результаты
            </a>
        </div>
        @if (ViewBag.nextGr == null)
        {
            <a id="nextStepBtn" class="btn btn-info rounded-pill rn-btn disabled" asp-action="GoToStepTwo" asp-controller="RunTournament" asp-route-tournId=@Model.Id>
                <span class="oi oi-chevron-right" aria-hidden="true"></span> Шаг 3
            </a>
        }
        else
        {
            <a id="nextStepBtn" class="btn btn-info rounded-pill rn-btn disabled" asp-action="GoToStepTwo" asp-controller="RunTournament" asp-route-tournId=@Model.Id>
                <span class="oi oi-chevron-right" aria-hidden="true"></span> @ViewBag.nextGr.Name
            </a>
        }
    </div>
    <div id="groupResults" class="mt-3 mb-3">
        <h5 id="loadingResults" class="text-muted ml-3"></h5>
    </div>

    @*<div class="row m-0 mt-3">
            <a id="formHeatsBtn" onclick="formHeats(@Model.Id)" class="btn btn-info rounded-pill rn-btn mr-2 text-white">Сформировать заходы</a>
            <a id="goToRefBtn" asp-action="GoToRefereeProcessStep" asp-controller="RunTournament" asp-route-groupId=@Model.Id class="btn btn-info rounded-pill rn-btn disabled">
                <span class="oi oi-chevron-right" aria-hidden="true"></span> Судейство
            </a>
        </div>
        <div id="groupHeats" class="mt-3 mb-3">
            <h5 id="loading" class="text-muted ml-3"></h5>
        </div>*@
</div>

<script>

    const timer =  setInterval(function () {
        $('#refProgress').load('/RunTournament/UpdateRefProgress/@Model.Id', function () {
            if ($('.progress-bar').attr('aria-valuenow') === $('.progress-bar').attr('aria-valuemax')) {
                $("#calcResBtn").removeClass("disabled");
                clearInterval(timer);
            } 
        });
    }, 6000)
</script>
